{"version":3,"sources":["../../../source/lib/drawing/picture.js"],"names":[],"mappings":"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","file":"picture.js","sourcesContent":["const Drawing = require('./drawing.js');\nconst path = require('path');\nconst imgsz = require('image-size');\nconst mime = require('mime');\n\nconst EMU = require('../classes/emu.js');\nconst xmlbuilder = require('xmlbuilder');\n\nclass Picture extends Drawing {\n\n    /**\n     * Element representing an Excel Picture subclass of Drawing\n     * @property {String} kind Kind of picture (currently only image is supported)\n     * @property {String} contentType Mime type of image\n     * @property {String} type ooxml schema\n     * @property {String} imagePath Filesystem path to image\n     * @property {String} name Name of image\n     * @property {String} description Description of image\n     * @property {String} title Title of image\n     * @property {String} id ID of image\n     * @property {String} noGrp pickLocks property\n     * @property {String} noSelect pickLocks property\n     * @property {String} noRot pickLocks property\n     * @property {String} noChangeAspect pickLocks property\n     * @property {String} noMove pickLocks property\n     * @property {String} noResize pickLocks property\n     * @property {String} noEditPoints pickLocks property\n     * @property {String} noAdjustHandles pickLocks property\n     * @property {String} noChangeArrowheads pickLocks property\n     * @property {String} noChangeShapeType pickLocks property\n     * @returns {Picture} Excel Picture  pickLocks property\n     */\n    constructor(opts) {\n        super();\n        this.kind = 'image';\n        this.contentType = mime.lookup(opts.path);\n        this.type = 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image';\n        this.imagePath = opts.path;\n        this._name = path.basename(opts.path);\n        this._descr = null;\n        this._title = null;\n        this._id;\n        // picLocks ยง20.1.2.2.31 picLocks (Picture Locks)\n        this.noGrp;\n        this.noSelect;\n        this.noRot;\n        this.noChangeAspect = true;\n        this.noMove;\n        this.noResize;\n        this.noEditPoints;\n        this.noAdjustHandles;\n        this.noChangeArrowheads;\n        this.noChangeShapeType;\n        if (['oneCellAnchor', 'twoCellAnchor'].indexOf(opts.position.type) >= 0) {\n            this.anchor(opts.position.type, opts.position.from, opts.position.to);\n        } else if (opts.position.type === 'absoluteAnchor') {\n            this.position(opts.position.x, opts.position.y);\n        } else {\n            throw new TypeError('Invalid option for anchor type. anchorType must be one of oneCellAnchor, twoCellAnchor, or absoluteAnchor');\n        }\n    }\n\n    get name() {\n        return this._name;\n    }\n    set name(newName) {\n        this._name = newName;\n    }\n    get id() {\n        return this._id;\n    }\n    set id(id) {\n        this._id = id;\n    }\n\n    get rId() {\n        return 'rId' + this._id;\n    }\n\n    get description() {\n        return this._descr !== null ? this._descr : this._name;\n    }\n    set description(desc) {\n        this._descr = desc;\n    }\n\n    get title() {\n        return this._title !== null ? this._title : this._name;\n    }\n    set title(title) {\n        this._title = title;\n    }\n\n    get extension() {\n        return path.extname(this.imagePath).substr(1);\n    }\n    get width() {\n        let pxWidth = imgsz(this.imagePath).width;\n        let inWidth = pxWidth / 96;\n        let emu = new EMU(inWidth + 'in');\n        return emu.value;\n    }\n\n    get height() {\n        let pxHeight = imgsz(this.imagePath).height;\n        let inHeight = pxHeight / 96;\n        let emu = new EMU(inHeight + 'in');\n        return emu.value;\n    }\n\n    /**\n     * @alias Picture.addToXMLele\n     * @desc When generating Workbook output, attaches pictures to the drawings xml file\n     * @func Picture.addToXMLele\n     * @param {xmlbuilder.Element} ele Element object of the xmlbuilder module\n     */\n    addToXMLele(ele) {\n\n        let anchorEle = ele.ele('xdr:' + this.anchorType);\n\n        if (this.editAs !== null) {\n            anchorEle.att('editAs', this.editAs);\n        }\n\n        if (this.anchorType === 'absoluteAnchor') {\n            anchorEle.ele('xdr:pos').att('x', this._position.x).att('y', this._position.y);\n        }\n\n        if (this.anchorType !== 'absoluteAnchor') {\n            let af = this.anchorFrom;\n            let afEle = anchorEle.ele('xdr:from');\n            afEle.ele('xdr:col').text(af.col);\n            afEle.ele('xdr:colOff').text(af.colOff);\n            afEle.ele('xdr:row').text(af.row);\n            afEle.ele('xdr:rowOff').text(af.rowOff);\n        }\n\n        if (this.anchorTo && this.anchorType === 'twoCellAnchor') {\n            let at = this.anchorTo;\n            let atEle = anchorEle.ele('xdr:to');\n            atEle.ele('xdr:col').text(at.col);\n            atEle.ele('xdr:colOff').text(at.colOff);\n            atEle.ele('xdr:row').text(at.row);\n            atEle.ele('xdr:rowOff').text(at.rowOff);                            \n        }\n\n        if (this.anchorType === 'oneCellAnchor' || this.anchorType === 'absoluteAnchor') {\n            anchorEle.ele('xdr:ext').att('cx', this.width).att('cy', this.height);\n        }\n\n        let picEle = anchorEle.ele('xdr:pic');\n        let nvPicPrEle = picEle.ele('xdr:nvPicPr');\n        let cNvPrEle = nvPicPrEle.ele('xdr:cNvPr');\n        cNvPrEle.att('descr', this.description);\n        cNvPrEle.att('id', this.id + 1);\n        cNvPrEle.att('name', this.name);\n        cNvPrEle.att('title', this.title);\n        let cNvPicPrEle = nvPicPrEle.ele('xdr:cNvPicPr');\n\n        this.noGrp === true ? cNvPicPrEle.ele('a:picLocks').att('noGrp', 1) : null;\n        this.noSelect === true ? cNvPicPrEle.ele('a:picLocks').att('noSelect', 1) : null;\n        this.noRot === true ? cNvPicPrEle.ele('a:picLocks').att('noRot', 1) : null;\n        this.noChangeAspect === true ? cNvPicPrEle.ele('a:picLocks').att('noChangeAspect', 1) : null;\n        this.noMove === true ? cNvPicPrEle.ele('a:picLocks').att('noMove', 1) : null;\n        this.noResize === true ? cNvPicPrEle.ele('a:picLocks').att('noResize', 1) : null;\n        this.noEditPoints === true ? cNvPicPrEle.ele('a:picLocks').att('noEditPoints', 1) : null;\n        this.noAdjustHandles === true ? cNvPicPrEle.ele('a:picLocks').att('noAdjustHandles', 1) : null;\n        this.noChangeArrowheads === true ? cNvPicPrEle.ele('a:picLocks').att('noChangeArrowheads', 1) : null;\n        this.noChangeShapeType === true ? cNvPicPrEle.ele('a:picLocks').att('noChangeShapeType', 1) : null;\n\n        let blipFillEle = picEle.ele('xdr:blipFill');\n        blipFillEle.ele('a:blip').att('r:embed', this.rId).att('xmlns:r', 'http://schemas.openxmlformats.org/officeDocument/2006/relationships');\n        blipFillEle.ele('a:stretch').ele('a:fillRect');\n\n        let spPrEle = picEle.ele('xdr:spPr');\n        let xfrmEle = spPrEle.ele('a:xfrm');\n        xfrmEle.ele('a:off').att('x', 0).att('y', 0);\n        xfrmEle.ele('a:ext').att('cx', this.width).att('cy', this.height);\n\n        let prstGeom = spPrEle.ele('a:prstGeom').att('prst', 'rect');\n        prstGeom.ele('a:avLst');\n\n        anchorEle.ele('xdr:clientData');\n    }\n}\n\nmodule.exports = Picture;"]}